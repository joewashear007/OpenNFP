@page "/"

@inject NavigationManager MyNavigationManager

@using PSC.Blazor.Components.Chartjs.Interfaces
@using System.Text.Json.Serialization
@using System.Collections.Generic

@inject IChartingRepo ChartingRepo

<MudContainer MaxWidth="MaxWidth.False">
    @foreach (var ci in cycles)
    {
        <CycleChart CycleIndex="@ci.Index" Cycle="@ci.Item" LimitDays=true />
    }
</MudContainer>

@code {

    private List<CycleIndex<Cycle>> cycles = new List<CycleIndex<Cycle>>();
    private int CycleLimit { get; set; } = 3;

    protected override async Task OnParametersSetAsync()
    {
        Console.WriteLine($"Index Render, Cycle Limit: {CycleLimit}, Count: {cycles.Count}");
        if (cycles.Count < CycleLimit)
        {
            cycles.Clear();
            foreach (var c in ChartingRepo.Cycles.Take(CycleLimit - cycles.Count))
            {
                if (c.Item != null)
                {
                    cycles.Add(c);
                }
            }
            StateHasChanged();
            await Task.Delay(50);
        }
    }
}
